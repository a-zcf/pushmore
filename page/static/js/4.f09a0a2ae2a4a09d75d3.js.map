{"version":3,"sources":["webpack:///src/views/ExchangeSuccess/ExchangeSuccess.vue","webpack:///./src/views/ExchangeSuccess/ExchangeSuccess.vue?cac4","webpack:///./src/views/ExchangeSuccess/ExchangeSuccess.vue"],"names":["ExchangeSuccess","name","data","giftId","show","giftType","amount","giftame","mounted","_this","this","$route","query","$nextTick","canvas","document","getElementById","ctx","getContext","arr","obj","valLeft","valTop","get","offsetLeft","offsetTop","offsetParent","tagName","getOffset","oLeft","oTop","beginPath","fillStyle","fillRect","width","height","font","textAlign","textBaseline","fillText","closePath","addEventListener","lineWidth","globalCompositeOperation","moveTo","event","touches","pageX","pageY","lineTo","stroke","percentage","pixels","getImageData","transPixels","i","length","push","toFixed","getFilledPercentage","parseInt","style","display","that","getScratchPrizeData","methods","_this2","$postRequest","api","then","res","code","giftData","gift","submAcceptAward","window","location","href","url","ExchangeSuccess_ExchangeSuccess","render","_vm","_h","$createElement","_c","_self","staticClass","_m","_v","directives","rawName","value","expression","attrs","id","_s","_e","nativeOn","click","$event","staticRenderFns","Component","__webpack_require__","normalizeComponent","ssrContext","__webpack_exports__"],"mappings":"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","file":"static/js/4.f09a0a2ae2a4a09d75d3.js","sourcesContent":["<template>\r\n  <div class=\"exchange-success\">\r\n    <div class=\"success\">\r\n        <i class=\"iconfont icon-chenggong icon-success\"></i>\r\n        <p>兑换礼品成功！</p>\r\n    </div>\r\n    <div class=\"chance-to-draw\" v-show=\"show\">\r\n       <p>恭喜您！还可以获得1次抽奖机会</p>\r\n       <div class=\"scraping-card\">\r\n         <div class=\"canvas-box\">\r\n             <div id=\"prize\" class=\"winning-results\">\r\n                <span class=\"winres-text\" v-if=\"giftType!=''\">{{giftType==0?'恭喜您！获得'+amount+'红包': giftame}}</span>\r\n                <span class=\"winres-text\" v-if=\"giftType==''\">继续刮刮...</span>\r\n                <van-button class=\"winres-but\" @click.native=\"submAcceptAward\">领<br/>奖</van-button>\r\n            </div>\r\n            <canvas id=\"canvas\"></canvas>\r\n         </div>\r\n       </div>\r\n    </div>\r\n    <div class=\"exchange-tips\">\r\n        <span class=\"tips-text\">温馨提示：</span>\r\n        <span class=\"describe-text\">1、成条（五份）兑换可获得一次抽奖机会，百分百中奖，最高获奖者千元奖励</span>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport {ScratchPrize,AcceptAward} from '../../api/api'\r\nexport default {\r\n   name:'ExchangeSuccess',\r\n   data() {\r\n       return{\r\n        giftId:'',\r\n        show:false,\r\n        giftType:'', // 0为红包，1为物料\r\n        amount:0, // 红包金额\r\n        giftame:'', // 礼品描述\r\n       }\r\n   },\r\n   mounted() {\r\n       this.giftId = this.$route.query.giftId\r\n       if(this.giftId != 0){\r\n        this.show = true\r\n       }else{\r\n        this.show = false\r\n       }\r\n       this.$nextTick(() => {\r\n        let canvas = document.getElementById(\"canvas\");\r\n        let ctx = canvas.getContext('2d');\r\n        /* 画布偏移量*/\r\n        let arr = getOffset(canvas);\r\n        let oLeft = arr[0];\r\n        let oTop = arr[1];\r\n        \r\n        /* 初始化画布*/\r\n        ctx.beginPath();\r\n        ctx.fillStyle = '#ccc';\r\n        ctx.fillRect(0,0,canvas.width,canvas.height);\r\n        // 设置字体\r\n        ctx.font = \"18px bold 黑体\";\r\n        // 设置颜色\r\n        ctx.fillStyle = \"red\";\r\n        // 设置水平对齐方式\r\n        ctx.textAlign = \"center\";\r\n        // 设置垂直对齐方式\r\n        ctx.textBaseline = \"middle\";\r\n        // 绘制文字（参数：绘制的文字，x坐标，y坐标）\r\n        ctx.fillText(\"开始刮奖\", 155, 80);\r\n        ctx.closePath();\r\n        \r\n        /* 增加触摸监听*/\r\n        document.addEventListener(\"touchstart\",function(){\r\n            /* 初始化画笔*/\r\n            ctx.beginPath();\r\n            /* 画笔粗细*/\r\n            ctx.lineWidth = 30;\r\n            /* 设置组合效果*/\r\n            ctx.globalCompositeOperation = 'destination-out';\r\n            /* 移动画笔原点*/\r\n            ctx.moveTo(event.touches[0].pageX-oLeft,event.touches[0].pageY-oTop);\r\n        },false)\r\n        \r\n        document.addEventListener(\"touchmove\",function(){\r\n            /* 根据手指移动画线，变透明*/\r\n            ctx.lineTo(event.touches[0].pageX-oLeft,event.touches[0].pageY-oTop);\r\n            /* 填充*/\r\n            ctx.stroke();\r\n        })\r\n        // 计算已经刮过的区域占整个区域的百分比\r\n        //鼠标按下后拖动\r\n        canvas.addEventListener('touchstart', function(event) {\r\n            // 通过像素点来计算，划过的面积\r\n            handleFilledPercentage(getFilledPercentage());\r\n        });\r\n\r\n        function getFilledPercentage() {\r\n            let imgData = ctx.getImageData(0,0,canvas.width,canvas.height);\r\n            // imgData.data数组，存储指定区域每个像素点的信息，数组中4个元素表示一个像素点的rgba值\r\n            let pixels = imgData.data;\r\n            let transPixels = [];\r\n            for(let i = 0; i < pixels.length; i += 4) {\r\n                // 判断像素点是否透明需要判断该像素点的a值是否等于0，\r\n                // 为了提高计算效率，这儿设置当a值小于128，也就是半透明状态时就可以了\r\n                if(pixels[i + 3] < 128) {\r\n                    transPixels.push(pixels[i + 3]);\r\n                }\r\n            }\r\n            return(transPixels.length / (pixels.length / 4) * 100).toFixed(2) + '%'\r\n        }\r\n        let that = this\r\n        // 设置阈值，隐藏canvas\r\n        function handleFilledPercentage(percentage) {\r\n            percentage = percentage || 0;\r\n            if(parseInt(percentage) > 25) {\r\n                // 当像素点的个数超过25%时，隐藏canvas\r\n                canvas.style.display = 'none'\r\n                that.getScratchPrizeData()\r\n            }\r\n        }\r\n                \r\n        /* 获取该元素到可视窗口的距离*/\r\n        function getOffset(obj){\r\n            var valLeft = 0,valTop = 0;\r\n            function get(obj){\r\n                valLeft += obj.offsetLeft;\r\n                valTop += obj.offsetTop;\r\n                /* 不到最外层就一直调用，直到offsetParent为body*/\r\n                if (obj.offsetParent.tagName!='BODY') {\r\n                  get(obj.offsetParent);\r\n                }\r\n                return [valLeft,valTop];\r\n            }\r\n            return get(obj);\r\n        }\r\n       })\r\n        \r\n},\r\n methods:{\r\n     // 刮奖\r\n    getScratchPrizeData(){\r\n        this.$postRequest(ScratchPrize,{giftId:this.giftId}).then(res => {\r\n            if(res.data.code =='0000') {\r\n              let giftData = res.data.data.gift\r\n              this.giftType = giftData.giftType\r\n              this.amount = giftData.amount\r\n              this.giftame = giftData.giftame\r\n            }\r\n        })\r\n    },\r\n    // 领奖\r\n    submAcceptAward(){\r\n     this.$postRequest(AcceptAward,{giftId:this.giftId}).then(res => {\r\n         if(res.data.code=='0000'){\r\n           window.location.href = res.data.data.gift.url\r\n         }\r\n     })\r\n }\r\n },\r\n \r\n}\r\n</script>\r\n\r\n<style>\r\n\r\n</style>\n\n\n// WEBPACK FOOTER //\n// src/views/ExchangeSuccess/ExchangeSuccess.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"exchange-success\"},[_vm._m(0),_vm._v(\" \"),_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.show),expression:\"show\"}],staticClass:\"chance-to-draw\"},[_c('p',[_vm._v(\"恭喜您！还可以获得1次抽奖机会\")]),_vm._v(\" \"),_c('div',{staticClass:\"scraping-card\"},[_c('div',{staticClass:\"canvas-box\"},[_c('div',{staticClass:\"winning-results\",attrs:{\"id\":\"prize\"}},[(_vm.giftType!='')?_c('span',{staticClass:\"winres-text\"},[_vm._v(_vm._s(_vm.giftType==0?'恭喜您！获得'+_vm.amount+'红包': _vm.giftame))]):_vm._e(),_vm._v(\" \"),(_vm.giftType=='')?_c('span',{staticClass:\"winres-text\"},[_vm._v(\"继续刮刮...\")]):_vm._e(),_vm._v(\" \"),_c('van-button',{staticClass:\"winres-but\",nativeOn:{\"click\":function($event){return _vm.submAcceptAward($event)}}},[_vm._v(\"领\"),_c('br'),_vm._v(\"奖\")])],1),_vm._v(\" \"),_c('canvas',{attrs:{\"id\":\"canvas\"}})])])]),_vm._v(\" \"),_vm._m(1)])}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"success\"},[_c('i',{staticClass:\"iconfont icon-chenggong icon-success\"}),_vm._v(\" \"),_c('p',[_vm._v(\"兑换礼品成功！\")])])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"exchange-tips\"},[_c('span',{staticClass:\"tips-text\"},[_vm._v(\"温馨提示：\")]),_vm._v(\" \"),_c('span',{staticClass:\"describe-text\"},[_vm._v(\"1、成条（五份）兑换可获得一次抽奖机会，百分百中奖，最高获奖者千元奖励\")])])}]\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-471ec248\",\"hasScoped\":false,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/views/ExchangeSuccess/ExchangeSuccess.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-471ec248\\\",\\\"scoped\\\":false,\\\"hasInlineConfig\\\":false}!../../../node_modules/vue-loader/lib/selector?type=styles&index=0!./ExchangeSuccess.vue\")\n}\nvar normalizeComponent = require(\"!../../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./ExchangeSuccess.vue\"\nimport __vue_script__ from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./ExchangeSuccess.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-471ec248\\\",\\\"hasScoped\\\":false,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../node_modules/vue-loader/lib/selector?type=template&index=0!./ExchangeSuccess.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = null\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/views/ExchangeSuccess/ExchangeSuccess.vue\n// module id = null\n// module chunks = "],"sourceRoot":""}