{"version":3,"sources":["webpack:///src/views/ExchangeSuccess/ExchangeSuccess.vue","webpack:///./src/views/ExchangeSuccess/ExchangeSuccess.vue?b993","webpack:///./src/views/ExchangeSuccess/ExchangeSuccess.vue"],"names":["ExchangeSuccess","name","data","giftId","show","show1","giftType","giftname","isDisable","status","mounted","_this","this","$route","query","document","title","canvas","style","display","getScratchPrizeData","$nextTick","getElementById","ctx","getContext","arr","obj","valLeft","valTop","get","offsetLeft","offsetTop","offsetParent","tagName","getOffset","oLeft","oTop","beginPath","fillStyle","fillRect","width","height","font","textAlign","textBaseline","fillText","closePath","addEventListener","lineWidth","globalCompositeOperation","moveTo","event","touches","pageX","pageY","lineTo","stroke","percentage","pixels","getImageData","transPixels","i","length","push","toFixed","getFilledPercentage","parseInt","that","methods","_this2","$postRequest","api","then","res","code","giftData","gift","submAcceptAward","_this3","window","location","href","url","ExchangeSuccess_ExchangeSuccess","render","_vm","_h","$createElement","_c","_self","staticClass","class","_v","_s","directives","rawName","value","expression","attrs","id","_e","nativeOn","click","$event","_m","staticRenderFns","Component","__webpack_require__","normalizeComponent","ssrContext","__webpack_exports__"],"mappings":"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","file":"static/js/5.19ab1a8282cc50196780.js","sourcesContent":["<template>\r\n  <div class=\"exchange-success\">\r\n    <div class=\"success\">\r\n        <i :class=\"status=='-2' || status=='-1'? 'iconfont icon-lipin icon-success':'iconfont icon-chenggong icon-success'\"></i>\r\n        <p>{{\r\n            status=='-2'?'在下方可进行抽奖活动哦':'' || \r\n            status=='-1'?'在下面抽奖区可领取您的奖品哦':'' || \r\n            '兑换礼品成功'}}\r\n        </p>\r\n    </div>\r\n    <div class=\"chance-to-draw\" v-show=\"show\">\r\n       <p v-show=\"show1\">恭喜您！额外获得1次抽奖机会</p>\r\n       <div class=\"scraping-card\">\r\n         <div class=\"canvas-box\">\r\n             <div id=\"prize\" class=\"winning-results\">\r\n                <span class=\"winres-text\" v-if=\"giftType!=''\">\r\n                    {{giftType == '0' ? '恭喜您！获得' + giftname : '获得' + giftname}}\r\n                    </span>\r\n                <span class=\"winres-text\" v-if=\"giftType == ''\">继续刮刮...</span>\r\n                <van-button class=\"winres-but\" @click.native=\"submAcceptAward\">领<br/>奖</van-button>\r\n            </div>\r\n            <canvas id=\"canvas\"></canvas>\r\n         </div>\r\n       </div>\r\n    </div>\r\n    <div class=\"exchange-tips\">\r\n        <span class=\"tips-text\">温馨提示：</span>\r\n        <span class=\"describe-text\">1、成条（五份）兑换可获得一次抽奖机会，最高获奖者千元奖励</span>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport {ScratchPrize,AcceptAward} from '../../api/api'\r\nexport default {\r\n   name:'ExchangeSuccess',\r\n   data() {\r\n       return{\r\n        giftId:'',\r\n        show:false,\r\n        show1:false,\r\n        giftType:'', // 0为红包，1为物料\r\n        giftname:'', // 礼品描述\r\n        isDisable:true,\r\n        status:''\r\n       }\r\n   },\r\n   mounted() {\r\n       this.giftId = this.$route.query.giftId\r\n       this.status = this.$route.query.status\r\n       document.title = '';\r\n       if(this.giftId != 0){\r\n        this.show = true\r\n       }else{\r\n        this.show = false\r\n       }\r\n       if(this.status=='-2' || this.status == '-1'){\r\n         document.title = '领奖';\r\n         this.show1 = false\r\n       }else{\r\n         document.title = '兑换成功';\r\n         this.show1 = true\r\n       }\r\n       if(this.status == '-1') {\r\n        canvas.style.display = 'none'\r\n        this.getScratchPrizeData()\r\n       }else{\r\n       this.$nextTick(() => {\r\n        let canvas = document.getElementById(\"canvas\");\r\n        let ctx = canvas.getContext('2d');\r\n        /* 画布偏移量*/\r\n        let arr = getOffset(canvas);\r\n        let oLeft = arr[0];\r\n        let oTop = arr[1];\r\n        \r\n        /* 初始化画布*/\r\n        ctx.beginPath();\r\n        ctx.fillStyle = '#ccc';\r\n        ctx.fillRect(0,0,canvas.width,canvas.height);\r\n        // 设置字体\r\n        ctx.font = \"20px bold 黑体\";\r\n        // 设置颜色\r\n        ctx.fillStyle = \"red\";\r\n        // 设置水平对齐方式\r\n        ctx.textAlign = \"center\";\r\n        // 设置垂直对齐方式\r\n        ctx.textBaseline = \"middle\";\r\n        // 绘制文字（参数：绘制的文字，x坐标，y坐标）\r\n        ctx.fillText(\"开始刮奖\", 155, 80);\r\n        ctx.closePath();\r\n        \r\n        /* 增加触摸监听*/\r\n        document.addEventListener(\"touchstart\",function(){\r\n            /* 初始化画笔*/\r\n            ctx.beginPath();\r\n            /* 画笔粗细*/\r\n            ctx.lineWidth = 30;\r\n            /* 设置组合效果*/\r\n            ctx.globalCompositeOperation = 'destination-out';\r\n            /* 移动画笔原点*/\r\n            ctx.moveTo(event.touches[0].pageX-oLeft,event.touches[0].pageY-oTop+25);\r\n        },false)\r\n        \r\n        document.addEventListener(\"touchmove\",function(){\r\n            /* 根据手指移动画线，变透明*/\r\n            ctx.lineTo(event.touches[0].pageX-oLeft,event.touches[0].pageY-oTop+25);\r\n            /* 填充*/\r\n            ctx.stroke();\r\n        })\r\n        // 计算已经刮过的区域占整个区域的百分比\r\n        // 鼠标按下后拖动\r\n        canvas.addEventListener('touchstart', function(event) {\r\n            // 通过像素点来计算，划过的面积\r\n            handleFilledPercentage(getFilledPercentage());\r\n        });\r\n\r\n        function getFilledPercentage() {\r\n            let imgData = ctx.getImageData(0,0,canvas.width,canvas.height);\r\n            // imgData.data数组，存储指定区域每个像素点的信息，数组中4个元素表示一个像素点的rgba值\r\n            let pixels = imgData.data;\r\n            let transPixels = [];\r\n            for(let i = 0; i < pixels.length; i += 4) {\r\n                // 判断像素点是否透明判断该像素点的a值是否等于0，\r\n                if(pixels[i + 3] < 128) {\r\n                    transPixels.push(pixels[i + 3]);\r\n                }\r\n            }\r\n            return(transPixels.length / (pixels.length / 4) * 100).toFixed(2) + '%'\r\n        }\r\n        let that = this\r\n        // 设置值，隐藏canvas\r\n        function handleFilledPercentage(percentage) {\r\n            percentage = percentage || 0;\r\n            if(parseInt(percentage) > 25) {\r\n                // 当像素点的个数超过25%时，隐藏canvas\r\n                canvas.style.display = 'none'\r\n                that.getScratchPrizeData()\r\n            }\r\n        }\r\n                \r\n        /* 获取该元素到可视窗口的距离*/\r\n        function getOffset(obj){\r\n            var valLeft = 0,valTop = 0;\r\n            function get(obj){\r\n                valLeft += obj.offsetLeft;\r\n                valTop += obj.offsetTop;\r\n                /* 不到最外层就一直调用，直到offsetParent为body*/\r\n                if (obj.offsetParent.tagName!='BODY') {\r\n                  get(obj.offsetParent);\r\n                }\r\n                return [valLeft,valTop];\r\n            }\r\n            return get(obj);\r\n        }\r\n       })}\r\n        \r\n},\r\n methods:{\r\n     // 刮奖\r\n    getScratchPrizeData(){\r\n        this.$postRequest(ScratchPrize,{giftId:this.giftId}).then(res => {\r\n            if(res.data.code =='0000') {\r\n              let giftData = res.data.data.gift\r\n              this.giftType = giftData.giftType\r\n              this.giftname = giftData.giftname\r\n            }\r\n        })\r\n    },\r\n    // 领奖\r\n    submAcceptAward(){\r\n        if(this.isDisable == false){\r\n            return\r\n        }\r\n        this.isDisable = false\r\n        this.$postRequest(AcceptAward,{giftId:this.giftId}).then(res => {\r\n            this.isDisable = true\r\n         if(res.data.code == '0000'){\r\n           window.location.href = res.data.data.gift.url\r\n         }\r\n     })\r\n }\r\n },\r\n \r\n}\r\n</script>\r\n\r\n<style>\r\n\r\n</style>\n\n\n// WEBPACK FOOTER //\n// src/views/ExchangeSuccess/ExchangeSuccess.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"exchange-success\"},[_c('div',{staticClass:\"success\"},[_c('i',{class:_vm.status=='-2' || _vm.status=='-1'? 'iconfont icon-lipin icon-success':'iconfont icon-chenggong icon-success'}),_vm._v(\" \"),_c('p',[_vm._v(_vm._s(_vm.status=='-2'?'在下方可进行抽奖活动哦':'' || \n          _vm.status=='-1'?'在下面抽奖区可领取您的奖品哦':'' || \n          '兑换礼品成功')+\"\\n      \")])]),_vm._v(\" \"),_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.show),expression:\"show\"}],staticClass:\"chance-to-draw\"},[_c('p',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.show1),expression:\"show1\"}]},[_vm._v(\"恭喜您！额外获得1次抽奖机会\")]),_vm._v(\" \"),_c('div',{staticClass:\"scraping-card\"},[_c('div',{staticClass:\"canvas-box\"},[_c('div',{staticClass:\"winning-results\",attrs:{\"id\":\"prize\"}},[(_vm.giftType!='')?_c('span',{staticClass:\"winres-text\"},[_vm._v(\"\\n                  \"+_vm._s(_vm.giftType == '0' ? '恭喜您！获得' + _vm.giftname : '获得' + _vm.giftname)+\"\\n                  \")]):_vm._e(),_vm._v(\" \"),(_vm.giftType == '')?_c('span',{staticClass:\"winres-text\"},[_vm._v(\"继续刮刮...\")]):_vm._e(),_vm._v(\" \"),_c('van-button',{staticClass:\"winres-but\",nativeOn:{\"click\":function($event){return _vm.submAcceptAward($event)}}},[_vm._v(\"领\"),_c('br'),_vm._v(\"奖\")])],1),_vm._v(\" \"),_c('canvas',{attrs:{\"id\":\"canvas\"}})])])]),_vm._v(\" \"),_vm._m(0)])}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"exchange-tips\"},[_c('span',{staticClass:\"tips-text\"},[_vm._v(\"温馨提示：\")]),_vm._v(\" \"),_c('span',{staticClass:\"describe-text\"},[_vm._v(\"1、成条（五份）兑换可获得一次抽奖机会，最高获奖者千元奖励\")])])}]\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-13a574c0\",\"hasScoped\":false,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/views/ExchangeSuccess/ExchangeSuccess.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-13a574c0\\\",\\\"scoped\\\":false,\\\"hasInlineConfig\\\":false}!../../../node_modules/vue-loader/lib/selector?type=styles&index=0!./ExchangeSuccess.vue\")\n}\nvar normalizeComponent = require(\"!../../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./ExchangeSuccess.vue\"\nimport __vue_script__ from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./ExchangeSuccess.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-13a574c0\\\",\\\"hasScoped\\\":false,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../node_modules/vue-loader/lib/selector?type=template&index=0!./ExchangeSuccess.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = null\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/views/ExchangeSuccess/ExchangeSuccess.vue\n// module id = null\n// module chunks = "],"sourceRoot":""}